# Spaces – Farcaster Audio Rooms Mini App

> Realtime audio rooms, tipping & Frames – built with Next.js, LiveKit, Base MiniKit, and OnchainKit.

This repository contains the source code for **Farcaster Spaces**, a Twitter-Spaces style mini-app that runs completely inside the Farcaster ecosystem.

- Live audio powered by **LiveKit**
- Tipping and wallet interactions via **Base MiniKit**
- Frame interactivity & notifications through **OnchainKit**
- Deployed as a modern **Next.js (App Router)** application

---

## ✨ Key Features

| Feature            | Description                                               |
| ------------------ | --------------------------------------------------------- |
| Start a Space      | One click to create a LiveKit room and share it via Frame |
| Join Space         | Anyone can join via link or Frame button                  |
| Participant List   | Live roster with active-speaker highlight                 |
| In-room Controls   | Mute / Un-mute / Leave via LiveKit `ControlBar`           |
| Frames Integration | Join / Tip buttons rendered directly in Warpcast          |
| Notifications      | Optional push when a followed host starts a space         |

---

## 🧱 Tech Stack

| Layer          | Tech                                                                |
| -------------- | ------------------------------------------------------------------- |
| Realtime Media | `livekit-client`, `@livekit/components-react`, `livekit-server-sdk` |
| Web Framework  | Next.js 15 (App Router + Server Components)                         |
| UI & Styling   | Tailwind CSS + LiveKit Components CSS                               |
| Wallet & Chain | `wagmi`, `viem`, **Base MiniKit**                                   |
| Farcaster      | `@farcaster/frame-sdk`, OnchainKit MiniKit provider                 |
| Data Store     | Upstash Redis (notifications)                                       |

---

## 🚀 Quick Start

1. **Clone & install**

```bash
pnpm install
```

2. **Create `.env.local`** – copy & fill the template below. **Never commit secrets.**

```bash
# — LiveKit —
LIVEKIT_API_KEY=lk_...
LIVEKIT_API_SECRET=...
LIVEKIT_URL=https://your-project.livekit.cloud
# Client WS URL (usually LIVEKIT_URL with wss://)
NEXT_PUBLIC_LIVEKIT_WS_URL=wss://your-project.livekit.cloud

# — OnchainKit / Frame metadata —
NEXT_PUBLIC_ONCHAINKIT_PROJECT_NAME=Farcaster Spaces
NEXT_PUBLIC_URL=http://localhost:3000
NEXT_PUBLIC_ICON_URL=https://...
NEXT_PUBLIC_ONCHAINKIT_API_KEY=...  # opt-in analytics

# Account Association (generated by `npx create-onchain --manifest`)
FARCASTER_HEADER=
FARCASTER_PAYLOAD=
FARCASTER_SIGNATURE=

# Redis (optional – for notifications)
REDIS_URL=
REDIS_TOKEN=
```

3. **Run dev server**

```bash
pnpm dev
```

Open <http://localhost:3000> and click **“Start a Space”** to launch your first room.

---

## 📂 Project Structure (high-level)

```
miniapp/
├─ app/
│  ├─ page.tsx               # Landing – start / join space
│  ├─ room/[room]/page.tsx   # Dynamic LiveKit room page
│  └─ api/
│     ├─ livekit/route.ts    # GET token endpoint
│     ├─ notify/route.ts     # Trigger Farcaster notifications
│     └─ webhook/route.ts    # Handle account-association webhooks
├─ lib/
│  ├─ livekit.ts             # Server SDK helpers (room + token)
│  ├─ notification*.ts       # Redis helper utilities
├─ public/                   # Icons, images
├─ tailwind.config.ts        # Styling
└─ other config files
```

---

## 🏗️ Scripts

| Command      | Description                                    |
| ------------ | ---------------------------------------------- |
| `pnpm dev`   | Start local dev server (http://localhost:3000) |
| `pnpm build` | Production build                               |
| `pnpm start` | Start built app                                |
| `pnpm lint`  | Run ESLint                                     |

---

## 🔐 Security Notes

- **Do not** expose your LiveKit **API Secret** to the client – token generation happens only in `/api/livekit` or server components.
- Rate-limit or protect the token endpoint in production (e.g. with user auth or signed URLs).
- Follow best practices when deploying environment variables (Vercel Secrets, GitHub Actions Secrets).

---

## 🛣 Roadmap

- [x] Audio-only rooms (current)
- [ ] Tipping workflow via Base MiniKit
- [ ] Farcaster Frame OG image with live participant count
- [ ] Host analytics (top tippers, listeners)

PRs & issues are welcome – let’s build together! 🛠️
