# Spaces â€“ Farcaster Audio Rooms Mini App

> Realtime audio rooms, tipping & Frames â€“ built with Next.js, LiveKit, Base MiniKit, and OnchainKit.

This repository contains the source code for **Farcaster Spaces**, a Twitter-Spaces style mini-app that runs completely inside the Farcaster ecosystem.

- Live audio powered by **LiveKit**
- Tipping and wallet interactions via **Base MiniKit**
- Frame interactivity & notifications through **OnchainKit**
- Deployed as a modern **Next.js (App Router)** application

---

## âœ¨ Key Features

| Feature            | Description                                               |
| ------------------ | --------------------------------------------------------- |
| Start a Space      | One click to create a LiveKit room and share it via Frame |
| Join Space         | Anyone can join via link or Frame button                  |
| Participant List   | Live roster with active-speaker highlight                 |
| In-room Controls   | Mute / Un-mute / Leave via LiveKit `ControlBar`           |
| Frames Integration | Join / Tip buttons rendered directly in Warpcast          |
| Notifications      | Optional push when a followed host starts a space         |

---

## ğŸ§± Tech Stack

| Layer          | Tech                                                                |
| -------------- | ------------------------------------------------------------------- |
| Realtime Media | `livekit-client`, `@livekit/components-react`, `livekit-server-sdk` |
| Web Framework  | Next.js 15 (App Router + Server Components)                         |
| UI & Styling   | Tailwind CSS + LiveKit Components CSS                               |
| Wallet & Chain | `wagmi`, `viem`, **Base MiniKit**                                   |
| Farcaster      | `@farcaster/frame-sdk`, OnchainKit MiniKit provider                 |
| Data Store     | Upstash Redis (notifications)                                       |

---

## ğŸš€ Quick Start

1. **Clone & install**

```bash
pnpm install
```

2. **Create `.env.local`** â€“ copy & fill the template below. **Never commit secrets.**

```bash
# â€” LiveKit â€”
LIVEKIT_API_KEY=lk_...
LIVEKIT_API_SECRET=...
LIVEKIT_URL=https://your-project.livekit.cloud
# Client WS URL (usually LIVEKIT_URL with wss://)
NEXT_PUBLIC_LIVEKIT_WS_URL=wss://your-project.livekit.cloud

# â€” OnchainKit / Frame metadata â€”
NEXT_PUBLIC_ONCHAINKIT_PROJECT_NAME=Farcaster Spaces
NEXT_PUBLIC_URL=http://localhost:3000
NEXT_PUBLIC_ICON_URL=https://...
NEXT_PUBLIC_ONCHAINKIT_API_KEY=...  # opt-in analytics

# Account Association (generated by `npx create-onchain --manifest`)
FARCASTER_HEADER=
FARCASTER_PAYLOAD=
FARCASTER_SIGNATURE=

# Redis (optional â€“ for notifications)
REDIS_URL=
REDIS_TOKEN=
```

3. **Run dev server**

```bash
pnpm dev
```

Open <http://localhost:3000> and click **â€œStart a Spaceâ€** to launch your first room.

---

## ğŸ“‚ Project Structure (high-level)

```
miniapp/
â”œâ”€ app/
â”‚  â”œâ”€ page.tsx               # Landing â€“ start / join space
â”‚  â”œâ”€ room/[room]/page.tsx   # Dynamic LiveKit room page
â”‚  â””â”€ api/
â”‚     â”œâ”€ livekit/route.ts    # GET token endpoint
â”‚     â”œâ”€ notify/route.ts     # Trigger Farcaster notifications
â”‚     â””â”€ webhook/route.ts    # Handle account-association webhooks
â”œâ”€ lib/
â”‚  â”œâ”€ livekit.ts             # Server SDK helpers (room + token)
â”‚  â”œâ”€ notification*.ts       # Redis helper utilities
â”œâ”€ public/                   # Icons, images
â”œâ”€ tailwind.config.ts        # Styling
â””â”€ other config files
```

---

## ğŸ—ï¸ Scripts

| Command      | Description                                    |
| ------------ | ---------------------------------------------- |
| `pnpm dev`   | Start local dev server (http://localhost:3000) |
| `pnpm build` | Production build                               |
| `pnpm start` | Start built app                                |
| `pnpm lint`  | Run ESLint                                     |

---

## ğŸ” Security Notes

- **Do not** expose your LiveKit **API Secret** to the client â€“ token generation happens only in `/api/livekit` or server components.
- Rate-limit or protect the token endpoint in production (e.g. with user auth or signed URLs).
- Follow best practices when deploying environment variables (Vercel Secrets, GitHub Actions Secrets).

---

## ğŸ›£ Roadmap

- [x] Audio-only rooms (current)
- [ ] Tipping workflow via Base MiniKit
- [ ] Farcaster Frame OG image with live participant count
- [ ] Host analytics (top tippers, listeners)

PRs & issues are welcome â€“ letâ€™s build together! ğŸ› ï¸
